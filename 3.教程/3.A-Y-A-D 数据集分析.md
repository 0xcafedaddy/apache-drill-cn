# Yelp 数据集分析

Apache Drill 是开源项目发展速度最快的项目之一，社区每月会发布一个版本。关键的不同点是 Drill 具有其敏捷性和灵活性。在会议上提出 SQL On Hadoop，用于完成低延时的性能指标，Drill 允许用户在没有 ETL 或事先没有定义 Schema 的情况下，完成数据的分析。数据可以为任意格式，例如 text，JSON 或是 Parquet。数据可以是简单类型，例如：string，integer，date 或是更加复杂结构数据，例如嵌套的 Map 集合和数组。数据可以在任何文件系统中存在，本地或是分布式中，例如 HDFS 或是 S3。Drill，有一个“无 Schema”的途径，它能够让你只需要几分钟，就能从你的数据中获得想要的值。

让我们快速的通过需要安装 Drill 和需要运行 Yelp 数据集的步骤。从 Yelp 中下载公开的示例数据集并将其格式化为 JSON。

# 安装和启动 Drill

## 下载 Apache Drill 到你本地机器

在本地进行 Drill 实验，按照 [快速指导](2.Drill in 10 Minutes 快速指导.md)的步骤进行实验。

另外，如果你想扩展你的环境，你可以将 Drill 部署在分布式环境下。

下面，让我们尝试用一些 SQL 示例，去理解 Drill 如何简易的分析数据。

```
注释：

你需要替换你本地路径的 Yelp 数据集在角括号中，针对你运行的每个查询。
```

# 在 Drill 中查询数据

## 1.可视化 Yelp 的业务数据

```bash
0: jdbc:drill:zk=local> !set maxwidth 10000

0: jdbc:drill:zk=local> select * from
    dfs.`<path-to-yelp-dataset>/yelp/yelp_academic_dataset_business.json`
    limit 1;

+------------------------+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------------------------------+---------+--------------+-------------------+-------------+-------+-------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+---------------+
| business_id            | full_address                                       | hours                                                                                                                                                                                                                                                      | open | categories                     | city    | review_count | name              | longitude   | state | stars | latitude  | attributes                                                                                                                                                   | type     | neighborhoods |
+------------------------+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------------------------------+---------+--------------+-------------------+-------------+-------+-------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+---------------+
| vcNAWiLM4dR7D2nwwJ7nCA | 4840 E Indian School Rd Ste 101, Phoenix, AZ 85018 | fill in{"Tuesday":{"close":"17:00","open":"08:00"},"Friday":{"close":"17:00","open":"08:00"},"Monday":{"close":"17:00","open":"08:00"},"Wednesday":{"close":"17:00","open":"08:00"},"Thursday":{"close":"17:00","open":"08:00"},"Sunday":{},"Saturday":{}} | true | ["Doctors","Health & Medical"] | Phoenix | 7            | Eric Goldberg, MD | -111.983758 | AZ    | 3.5   | 33.499313 | {"By Appointment Only":true,"Good For":{},"Ambience":{},"Parking":{},"Music":{},"Hair Types Specialized In":{},"Payment Types":{},"Dietary Restrictions":{}} | business | []            |
+------------------------+----------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------------------------------+---------+--------------+-------------------+-------------+-------+-------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+---------------+
```

```
注释：

本文件以示例为目的对 Drill 结果进行输出。这种输出是不对称的（即：不能完全匹配）。
```

你可以直接查询自定义的文件，例如 JSON，Parquet 和 text 文件。它们不需要创建和定义元数据在 Hive 的元数据中。

## 2.进一步探索业务数据集

在数据集中的浏览总数：

```bash
0: jdbc:drill:zk=local> select sum(review_count) as totalreviews
from dfs.`/<path-to-yelp-dataset>/yelp/yelp_academic_dataset_business.json`;

+--------------+
| totalreviews |
+--------------+
| 1236445      |
+--------------+
```

国家和城市总数的评论：

```bash
0: jdbc:drill:zk=local> select state, city, count(*) totalreviews
from dfs.`/<path-to-yelp-dataset>/yelp/yelp_academic_dataset_business.json`
group by state, city order by count(*) desc limit 10;

+------------+------------+--------------+
|   state    |    city    | totalreviews |
+------------+------------+--------------+
| NV         | Las Vegas  | 12021        |
| AZ         | Phoenix    | 7499         |
| AZ         | Scottsdale | 3605         |
| EDH        | Edinburgh  | 2804         |
| AZ         | Mesa       | 2041         |
| AZ         | Tempe      | 2025         |
| NV         | Henderson  | 1914         |
| AZ         | Chandler   | 1637         |
| WI         | Madison    | 1630         |
| AZ         | Glendale   | 1196         |
+------------+------------+--------------+
```
