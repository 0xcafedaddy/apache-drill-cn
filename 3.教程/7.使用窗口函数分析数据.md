# 使用窗口函数分析数据

本教程简要介绍 Drill 1.2 的分析，即分析窗口函数的 ANSI SQL 标准。Drill 支持以下窗口函数：
  * PARTITION BY 和 OVER 语法
  * 不同种类的聚合函数，如 Sum，Max，Min，Count，Avg
  * 解析函数，例如 First_Value, Last_Value, Lead, Lag, NTile, Row_Number 和 Rank

窗口函数是多功能的。你可以减少连接，子查询，和显示游标，你只需要写而已。窗口函数以最小的编码工作，解决了各种复杂的情况。

本教程建立在前面的教程之上，[A-Y-A-D 数据分析](3.A-Y-A-D 数据集分析.md) 和 [高度动态的数据集分析](5.高度动态的数据集分析.md)，并且使用的是相同的 Yelp 数据集。

## 开始

  1. 在开始前，下载 Yelp（商业评论）。
  2. [安装并启动 Drill](3.A-Y-A-D 数据集分析.md)。
  3. 在 Drill 中列出可用的 Schema。
    ```bash
    SHOW schemas;
    +---------------------+
    |     SCHEMA_NAME     |
    +---------------------+
    | INFORMATION_SCHEMA  |
    | cp.default          |
    | dfs.default         |
    | dfs.root            |
    | dfs.tmp             |
    | dfs.yelp            |
    | sys                 |
    +---------------------+

    7 rows selected (1.755 seconds)
    ```
  4. 切换工作目录。
    ```bash
    USE dfs.yelp;

    +-------+---------------------------------------+
    |  ok   |                summary                |
    +-------+---------------------------------------+
    | true  | Default schema changed to [dfs.yelp]  |
    +-------+---------------------------------------+

    1 row selected (0.129 seconds)
    ```
  5. 开始探索 Yelp 中可用的数据集信息。
    ```bash
    SELECT * FROM `business.json` LIMIT 1;

    +------------------------+-----------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------------------------------+---------+--------------+-------------------+-------------+-------+-------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------+---------------+
    | business_id            | full_address                                        | hours                                                                                                                                                                                                                                               | open |         categories             |   city  | review_count |        name       |  longitude  | state | stars |  latitude | attributes                                                                                                                                          |    type  | neighborhoods |
    +------------------------+--------------+------+-------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------------------------------+---------+--------------+-------------------+-------------+-------+-------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------+---------------+
    | vcNAWiLM4dR7D2nwwJ7nCA | 4840 E Indian School Rd Ste 101 Phoenix, AZ 85018   | {"Tuesday":{"close":"17:00","open":"08:00"},"Friday":{"close":"17:00","open":"08:00"},"Monday":{"close":"17:00","open":"08:00"},"Wednesday":{"close":"17:00","open":"08:00"},"Thursday":{"close":"17:00","open":"08:00"},"Sunday":{},"Saturday":{}} | true | ["Doctors","Health & Medical"] | Phoenix |      7       | Eric Goldberg, MD | -111.983758 |   AZ  |  3.5  | 33.499313 | {"By Appointment Only":true,"Good Ambience":{},"Parking":{},"Music":{},"Hair Types Specialized In":{},"Payment Types":{},"Dietary Restrictions":{}} | business |      []       |
    +-------------+--------------+-------+------+------------+------+--------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------------------------------+---------+--------------+-------------------+-------------+-------+-------+-----------+-----------------------------------------------------------------------------------------------------------------------------------------------------+----------+---------------+
    1 row selected (0.514 seconds)
    ```
